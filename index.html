<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllMarket - Capturador de Notas</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; line-height: 1.6; }
        textarea { width: 100%; height: 200px; margin: 10px 0; }
        .step { background: #f4f4f4; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid #2ecc71; }
        button { background: #2ecc71; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; font-weight: bold; }
        button:hover { background: #27ae60; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 15px; overflow-x: auto; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ðŸ›’ AllMarket - Extrator de Itens</h1>

    <div class="step">
        <h3>Passo 1: Abrir a Nota</h3>
        <p>Abra o link da SEFAZ, resolva o Captcha e quando os produtos aparecerem, copie o cÃ³digo-fonte da pÃ¡gina (Ctrl+U ou Inspecionar).</p>
    </div>

    <div class="step">
        <h3>Passo 2: Colar o HTML</h3>
        <textarea id="htmlInput" placeholder="Cole aqui o <html> completo da pÃ¡gina da nota..."></textarea>
        <button onclick="enviarParaAPI()">Processar Itens na API Go</button>
    </div>

    <div class="step">
        <h3>Resultado da API:</h3>
        <pre id="resultado">Aguardando processamento...</pre>
    </div>

 <script>
    async function enviarParaAPI() {
        // Pega o que vocÃª colou no campo de texto
        const conteudoInput = document.getElementById('htmlInput').value;
        const display = document.getElementById('resultado');

        if (!conteudoInput) {
            alert("Por favor, cole a URL da nota primeiro!");
            return;
        }

        display.innerText = "Buscando dados na SEFAZ...";

        try {
            const resposta = await fetch('http://localhost:8080/processar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: conteudoInput }) 
            });

            const dados = await resposta.json();
            
            if (dados.erro) {
                display.innerText = "Erro no Servidor: " + dados.erro;
            } else {
                display.innerText = JSON.stringify(dados, null, 2);
            }

        } catch (erro) {
            display.innerText = "Erro ao conectar com a API Go: " + erro.message;
        }
    }
</script>
</body>
</html>